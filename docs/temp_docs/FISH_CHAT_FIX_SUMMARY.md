# é±¼èŠå¤©åŠŸèƒ½ä¿®å¤æ€»ç»“

**æ—¥æœŸ**: 2025-11-08  
**é—®é¢˜**: æ²¡æœ‰çœ‹åˆ°ç¾¤èŠï¼ˆä½¿ç”¨fallbackæ•°æ®ï¼‰ï¼Œè‡ªè¯­åŠŸèƒ½å®Œå…¨æ²¡æœ‰

---

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. ä¿®æ”¹ç¾¤èŠAPIè°ƒç”¨
- **æ–‡ä»¶**: `src/js/community-chat-manager.js`
- **æ”¹åŠ¨**:
  - å°†APIä» `/api/fish/community-chat` æ”¹ä¸º `/api/fish/chat/group` (çœŸæ­£çš„Coze AI)
  - æ›´æ–°å“åº”å¤„ç†ï¼Œé€‚é…æ–°APIçš„è¿”å›æ ¼å¼

### 2. å®ç°è‡ªè¯­åŠŸèƒ½
- **æ–‡ä»¶**: `src/js/community-chat-manager.js`
- **æ–°å¢æ–¹æ³•**:
  - `generateMonologue()` - éšæœºé€‰æ‹©é±¼å¹¶è°ƒç”¨ `/api/fish/chat/monologue` API
  - `displayMonologue()` - æ˜¾ç¤ºè‡ªè¯­å†…å®¹
  - `scheduleMonologues(intervalSeconds)` - å®šæœŸè§¦å‘è‡ªè¯­ï¼ˆé»˜è®¤15ç§’ï¼‰

### 3. å¯ç”¨è‡ªè¯­è°ƒåº¦
- **æ–‡ä»¶**: `src/js/tank.js`
- **æ”¹åŠ¨**: åœ¨åˆå§‹åŒ–æ—¶æ·»åŠ  `communityChatManager.scheduleMonologues(15)`

### 4. æ›´æ–°ç‰ˆæœ¬å·
- **æ–‡ä»¶**: `tank.html`
- **æ”¹åŠ¨**:
  - `community-chat-manager.js?v=1.2` â†’ `v=2.0`
  - `tank.js?v=3.9` â†’ `v=4.0`

---

## âš ï¸ æµè§ˆå™¨ç¼“å­˜é—®é¢˜

è™½ç„¶ç‰ˆæœ¬å·å·²æ›´æ–°ï¼Œä½†æµè§ˆå™¨å¯èƒ½ä»åœ¨ä½¿ç”¨ç¼“å­˜çš„æ—§æ–‡ä»¶ã€‚

### è§£å†³æ–¹æ¡ˆï¼š

#### æ–¹æ¡ˆ1: æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆæ¨èï¼‰
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘å·¥å…·ï¼ˆF12ï¼‰
2. å³é”®ç‚¹å‡»åˆ·æ–°æŒ‰é’® â†’ é€‰æ‹©"æ¸…ç©ºç¼“å­˜å¹¶ç¡¬æ€§é‡æ–°åŠ è½½"
3. æˆ–è€…ä½¿ç”¨éšèº«æ¨¡å¼æ‰“å¼€é¡µé¢

#### æ–¹æ¡ˆ2: é‡å¯å¼€å‘æœåŠ¡å™¨
```bash
# åœæ­¢å½“å‰æœåŠ¡å™¨ (Ctrl+C)
cd D:\BaiduSyncdisk\CODE_PRJ\fish_art
npm run dev
```

#### æ–¹æ¡ˆ3: ä½¿ç”¨å¼€å‘å·¥å…·ç¦ç”¨ç¼“å­˜
1. F12æ‰“å¼€å¼€å‘å·¥å…·
2. Networkæ ‡ç­¾é¡µ
3. å‹¾é€‰"Disable cache"
4. åˆ·æ–°é¡µé¢

---

## ğŸ“‹ éªŒè¯æ­¥éª¤

æ¸…é™¤ç¼“å­˜åï¼Œæ£€æŸ¥æ§åˆ¶å°åº”è¯¥çœ‹åˆ°ï¼š

1. **è‡ªè¯­è°ƒåº¦æ—¥å¿—**:
   ```
   ğŸ’¬ Monologues scheduled every 15 seconds
   ```

2. **ç¾¤èŠAPIè°ƒç”¨**ï¼ˆä¸å†æ˜¯fallbackï¼‰:
   ```
   âœ… Group chat generated: X messages
   {sessionId: "...", topic: "..."}  // ä¸å†æœ‰ usedFallback: true
   ```

3. **è‡ªè¯­åŠŸèƒ½**ï¼ˆ20ç§’åå¼€å§‹ï¼Œæ¯15ç§’ä¸€æ¬¡ï¼‰:
   ```
   ğŸ—£ï¸ Generating monologue for: FishName (personality)
   âœ… Monologue generated for FishName: ...
   ğŸ’¬ [Monologue] FishName: ...
   ```

---

## ğŸ”§ APIç«¯ç‚¹è¯´æ˜

### ç¾¤èŠAPI
- **ç«¯ç‚¹**: `/api/fish/chat/group`
- **æ–¹æ³•**: POST
- **å‚æ•°**: `{ prompt: "Generate a ... conversation" }`
- **è¿”å›**: `{ success, sessionId, topic, dialogues, participants }`

### è‡ªè¯­API
- **ç«¯ç‚¹**: `/api/fish/chat/monologue`
- **æ–¹æ³•**: POST
- **å‚æ•°**: æ— ï¼ˆè‡ªåŠ¨éšæœºé€‰æ‹©é±¼ï¼‰
- **è¿”å›**: `{ success, fish: {...}, message: "...", logId: "..." }`

---

## ğŸ“Š åŠŸèƒ½è¯´æ˜

### ç¾¤èŠ (Group Chat)
- **é¢‘ç‡**: æ¯5åˆ†é’Ÿ
- **å‚ä¸é±¼æ•°**: 5-8æ¡
- **æ¥æº**: Coze AIç”Ÿæˆï¼ˆçœŸå®å¯¹è¯ï¼Œä¸æ˜¯fallbackï¼‰
- **æ˜¾ç¤º**: æ°”æ³¡å½¢å¼ï¼Œæ¯æ¡æ¶ˆæ¯é—´éš”6ç§’

### è‡ªè¯­ (Monologue)
- **é¢‘ç‡**: æ¯15ç§’
- **å‚ä¸é±¼æ•°**: æ¯æ¬¡éšæœº1æ¡
- **æ¥æº**: `fish_monologues`è¡¨ä¸­çš„é¢„è®¾å†…å®¹ï¼ŒæŒ‰ä¸ªæ€§åˆ†ç±»
- **æ˜¾ç¤º**: æ°”æ³¡å½¢å¼ï¼Œæ˜¾ç¤º8ç§’

---

## ğŸ¯ åç»­ä¼˜åŒ–å»ºè®®

1. **ä»global_paramsè¡¨è¯»å–é¢‘ç‡å‚æ•°**ï¼ˆç›®å‰ç¡¬ç¼–ç ä¸º5åˆ†é’Ÿå’Œ15ç§’ï¼‰
2. **ç¾¤èŠfallbackä¼˜åŒ–** - å½“Coze APIå¤±è´¥æ—¶ï¼Œç”Ÿæˆæ›´ä¸°å¯Œçš„fallbackå¯¹è¯
3. **è‡ªè¯­åˆ†ç±»** - æ ¹æ®æ—¶æ®µï¼ˆæ—©ä¸­æ™šå¤œï¼‰é€‰æ‹©ä¸åŒé£æ ¼çš„è‡ªè¯­
4. **æ˜¾ç¤ºä¼˜åŒ–** - åŒºåˆ†ç¾¤èŠæ°”æ³¡å’Œè‡ªè¯­æ°”æ³¡çš„è§†è§‰æ ·å¼





