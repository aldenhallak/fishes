# ✅ 部署检查清单

在正式上线前，请确保完成以下所有检查项。

---

## 📋 环境配置

### 1. 环境变量配置
- [ ] 已创建 `.env.local` 文件
- [ ] 已设置 `HASURA_GRAPHQL_ENDPOINT`
- [ ] 已设置 `HASURA_ADMIN_SECRET`
- [ ] 已设置 `UPSTASH_REDIS_URL`
- [ ] 已设置 `NODE_ENV=production`（生产环境）
- [ ] 已设置 `MAX_BATTLE_USERS`（并发限制）

### 2. Vercel环境变量
- [ ] 在Vercel Dashboard设置所有环境变量
- [ ] 生产环境和预览环境分别配置
- [ ] 测试环境变量是否生效

---

## 🗄️ 数据库设置

### 1. Hasura配置
- [ ] PostgreSQL数据库已创建
- [ ] 执行 `scripts/migrate-database.sql` 完成
- [ ] 所有表已在Hasura中Track
- [ ] 权限配置正确（Admin Secret保护）
- [ ] 测试GraphQL查询正常

### 2. 数据初始化
- [ ] `battle_config` 表已插入默认配置
- [ ] 测试数据已导入（如需要）
- [ ] 数据库备份已设置

---

## 🔴 Redis配置

### 1. Upstash设置
- [ ] 已注册Upstash账号
- [ ] 已创建Redis数据库
- [ ] 已选择合适的计划（Pro推荐）
- [ ] 已配置TLS
- [ ] 连接测试通过

### 2. Redis功能测试
- [ ] 读写操作正常
- [ ] 队列功能正常
- [ ] 速率限制正常
- [ ] TTL过期机制正常

---

## 🧪 功能测试

### 1. 战斗系统
- [ ] 进入战斗模式正常
- [ ] 离开战斗模式正常
- [ ] 心跳保活正常
- [ ] 战斗触发正常
- [ ] 队列系统正常
- [ ] 并发限制生效
- [ ] 战斗结算正确
- [ ] 经验和血量更新正确

### 2. 经济系统
- [ ] 查询余额正常
- [ ] 每日签到正常
- [ ] 喂食功能正常
- [ ] 复活功能正常
- [ ] 创建新鱼正常
- [ ] 鱼食扣除正确
- [ ] 日志记录完整

### 3. 前端集成
- [ ] battle-client.js加载正常
- [ ] battle-animation.js加载正常
- [ ] API调用正常
- [ ] 动画播放流畅
- [ ] 页面卸载正确处理

---

## 🔒 安全检查

### 1. 敏感信息保护
- [ ] `.env.local` 已加入 `.gitignore`
- [ ] Admin Secret足够复杂（32+字符）
- [ ] Redis密码足够安全
- [ ] 没有硬编码敏感信息

### 2. API安全
- [ ] 实施速率限制
- [ ] 添加CORS配置
- [ ] 验证用户权限
- [ ] 防止SQL注入
- [ ] 防止XSS攻击

### 3. 数据验证
- [ ] 所有输入都进行验证
- [ ] 鱼ID验证（UUID格式）
- [ ] 用户ID验证
- [ ] 金额验证（非负数）

---

## 📊 性能优化

### 1. Redis缓存
- [ ] 鱼数据缓存启用
- [ ] 战斗配置缓存启用
- [ ] TTL设置合理
- [ ] 缓存失效机制正确

### 2. 数据库优化
- [ ] 索引已创建
- [ ] 查询性能测试通过
- [ ] 批量更新使用正确

### 3. 前端优化
- [ ] 静态资源压缩
- [ ] 图片优化
- [ ] 懒加载实施
- [ ] CDN配置（如需要）

---

## 📈 监控和日志

### 1. 日志系统
- [ ] 战斗日志正常记录
- [ ] 经济日志正常记录
- [ ] 错误日志可查看
- [ ] 日志级别配置正确

### 2. 监控设置
- [ ] Hasura监控启用
- [ ] Redis监控启用
- [ ] Vercel Analytics启用
- [ ] 异常告警配置

### 3. 性能指标
- [ ] API响应时间 < 200ms
- [ ] Redis延迟 < 50ms
- [ ] 战斗动画流畅（60fps）
- [ ] 并发支持达标

---

## 🚀 部署流程

### 1. 预部署
- [ ] 代码已提交到Git
- [ ] 所有测试通过
- [ ] 文档已更新
- [ ] 版本号已更新

### 2. 部署到Vercel
- [ ] 连接GitHub仓库
- [ ] 配置环境变量
- [ ] 触发部署
- [ ] 检查部署日志
- [ ] 验证部署成功

### 3. 部署后验证
- [ ] 访问生产环境URL
- [ ] 测试所有API端点
- [ ] 测试前端功能
- [ ] 检查数据库连接
- [ ] 检查Redis连接

---

## 📱 用户体验

### 1. UI/UX测试
- [ ] 战斗动画流畅
- [ ] 血条显示正确
- [ ] 等级显示正确
- [ ] 按钮响应及时
- [ ] 错误提示友好

### 2. 移动端测试
- [ ] 响应式布局正常
- [ ] 触摸交互正常
- [ ] 性能可接受

### 3. 浏览器兼容
- [ ] Chrome测试通过
- [ ] Firefox测试通过
- [ ] Safari测试通过
- [ ] Edge测试通过

---

## 💰 商业功能

### 1. 支付系统（如已集成）
- [ ] Stripe配置正确
- [ ] 测试支付流程
- [ ] Webhook配置正确
- [ ] 退款流程测试

### 2. 用户分析
- [ ] 埋点配置完成
- [ ] 用户行为追踪
- [ ] 转化漏斗分析

---

## 📞 支持准备

### 1. 文档完备
- [ ] API文档完整
- [ ] 部署指南完整
- [ ] 故障排查文档完整
- [ ] FAQ文档完整

### 2. 应急预案
- [ ] 数据库回滚方案
- [ ] 紧急降级方案
- [ ] 联系人列表
- [ ] 监控告警配置

---

## ✅ 最终确认

在正式上线前，请确认：

- [ ] 所有上述检查项已完成
- [ ] 团队成员已通知
- [ ] 备份已创建
- [ ] 监控已启用
- [ ] 支持团队就绪

**签字确认：**
- 开发负责人：____________  日期：______
- 测试负责人：____________  日期：______
- 运维负责人：____________  日期：______

---

## 🎉 上线后

### 立即任务
- [ ] 监控系统指标
- [ ] 检查错误日志
- [ ] 收集用户反馈
- [ ] 记录问题和改进点

### 24小时内
- [ ] 性能分析报告
- [ ] 用户数据分析
- [ ] Bug修复（如有）
- [ ] 优化调整

---

祝您部署顺利！🚀



