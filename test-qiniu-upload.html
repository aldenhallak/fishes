<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸ƒç‰›äº‘ä¸Šä¼ æµ‹è¯• - Fish Art</title>
  <!-- <link rel="stylesheet" href="src/css/common.css"> -->
  <style>
    body {
      background: #f7fafc;
      min-height: 100vh;
      padding: 2rem;
    }

    .test-container {
      max-w: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      padding: 2rem;
    }

    .test-header {
      margin-bottom: 2rem;
      border-bottom: 2px solid #e2e8f0;
      padding-bottom: 1rem;
    }

    .test-header h1 {
      font-size: 2rem;
      color: #1a202c;
      margin-bottom: 0.5rem;
    }

    .test-header p {
      color: #718096;
    }

    .upload-section {
      margin-bottom: 2rem;
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 1rem;
    }

    .drop-zone {
      border: 2px dashed #cbd5e0;
      border-radius: 8px;
      padding: 3rem;
      text-align: center;
      transition: all 0.3s;
      cursor: pointer;
      background: #f7fafc;
    }

    .drop-zone:hover {
      border-color: #667eea;
      background: #edf2f7;
    }

    .drop-zone.drag-active {
      border-color: #667eea;
      background: #e6f2ff;
    }

    .drop-zone-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .drop-zone-text {
      font-size: 1.1rem;
      color: #2d3748;
      margin-bottom: 0.5rem;
    }

    .drop-zone-hint {
      color: #718096;
      font-size: 0.9rem;
    }

    .file-input {
      display: none;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
    }

    .btn-primary:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: #4a5568;
      color: white;
    }

    .btn-secondary:hover {
      background: #2d3748;
    }

    .btn-secondary:disabled {
      background: #e2e8f0;
      cursor: not-allowed;
    }

    .btn-preview {
      background: #667eea;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      font-size: 0.875rem;
    }

    .btn-copy {
      background: #48bb78;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      font-size: 0.875rem;
    }

    .button-group {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }

    .results-section {
      margin-top: 2rem;
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .results-container {
      max-height: 600px;
      overflow-y: auto;
    }

    .result-item {
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .result-item.success {
      background: #f0fff4;
      border-color: #9ae6b4;
    }

    .result-item.error {
      background: #fff5f5;
      border-color: #fc8181;
    }

    .status-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
    }

    .result-item.success .status-badge {
      background: #9ae6b4;
      color: #22543d;
    }

    .result-item.error .status-badge {
      background: #fc8181;
      color: #742a2a;
    }

    .result-content {
      margin-top: 0.75rem;
    }

    .result-field {
      margin-bottom: 0.75rem;
    }

    .result-field strong {
      color: #2d3748;
      display: inline-block;
      min-width: 80px;
    }

    .result-link {
      color: #667eea;
      word-break: break-all;
    }

    .result-link:hover {
      text-decoration: underline;
    }

    .result-field code {
      background: #edf2f7;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.875rem;
      color: #2d3748;
    }

    .result-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .error-message {
      color: #c53030;
    }

    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      color: #667eea;
    }

    .spinner {
      border: 3px solid #e2e8f0;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-right: 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .info-box {
      background: #edf2f7;
      border-left: 4px solid #667eea;
      padding: 1rem;
      border-radius: 4px;
      margin-top: 2rem;
    }

    .info-box h3 {
      color: #2d3748;
      margin-bottom: 0.5rem;
    }

    .info-box ul {
      list-style: none;
      padding-left: 0;
    }

    .info-box li {
      color: #4a5568;
      padding: 0.25rem 0;
      font-size: 0.9rem;
    }

    .info-box li::before {
      content: "â€¢ ";
      color: #667eea;
      font-weight: bold;
      margin-right: 0.5rem;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      color: #667eea;
      text-decoration: none;
      font-weight: 500;
      margin-top: 2rem;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    .json-result {
      background: #1a202c;
      color: #e2e8f0;
      padding: 1rem;
      border-radius: 6px;
      overflow-x: auto;
      font-size: 0.875rem;
      line-height: 1.5;
    }

    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      opacity: 0;
      transform: translateY(-20px);
      transition: all 0.3s;
      z-index: 1000;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    .toast.toast-success {
      background: #48bb78;
      color: white;
    }

    .toast.toast-error {
      background: #f56565;
      color: white;
    }

    .toast.toast-info {
      background: #4299e1;
      color: white;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <div class="test-header">
      <h1>ğŸ“ ä¸ƒç‰›äº‘ä¸Šä¼ æµ‹è¯•</h1>
      <p>æµ‹è¯•ä¸ƒç‰›äº‘å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼Œæ”¯æŒæ‹–æ‹½ä¸Šä¼ ã€é¢„è§ˆå’Œä¸‹è½½</p>
    </div>

    <!-- ä¸Šä¼ åŒºåŸŸ -->
    <div class="upload-section">
      <h2 class="section-title">ä¸Šä¼ æ–‡ä»¶</h2>
      <div class="drop-zone" id="dropZone">
        <div class="drop-zone-icon">ğŸ“¤</div>
        <p class="drop-zone-text">æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
        <p class="drop-zone-hint">æ”¯æŒå›¾ç‰‡æ ¼å¼ï¼šJPG, PNG, GIF, WebP</p>
      </div>
      <input type="file" id="fileInput" class="file-input" accept="image/*" multiple>
      
      <div class="button-group">
        <button class="btn btn-primary" id="selectBtn">é€‰æ‹©æ–‡ä»¶</button>
        <button class="btn btn-secondary" id="clearBtn" disabled>æ¸…é™¤ç»“æœ</button>
      </div>
    </div>

    <!-- åŠ è½½çŠ¶æ€ -->
    <div class="loading" id="loadingIndicator" style="display: none;">
      <div class="spinner"></div>
      <span>ä¸Šä¼ ä¸­...</span>
    </div>

    <!-- ç»“æœå±•ç¤º -->
    <div class="results-section" id="resultsSection" style="display: none;">
      <div class="results-header">
        <h2 class="section-title">ä¸Šä¼ ç»“æœ</h2>
      </div>
      <div class="results-container" id="resultsContainer"></div>
    </div>

    <!-- ä½¿ç”¨è¯´æ˜ -->
    <div class="info-box">
      <h3>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3>
      <ul>
        <li>æ”¯æŒæ‹–æ‹½ä¸Šä¼ å’Œç‚¹å‡»é€‰æ‹©æ–‡ä»¶</li>
        <li>æ”¯æŒå¤šæ–‡ä»¶åŒæ—¶ä¸Šä¼ </li>
        <li>ä¸Šä¼ æˆåŠŸåå¯ä»¥é¢„è§ˆå’Œä¸‹è½½æ–‡ä»¶</li>
        <li>æ–‡ä»¶ä¼šè‡ªåŠ¨ä¸Šä¼ åˆ°ä¸ƒç‰›äº‘CDN</li>
        <li>ç¡®ä¿å·²æ­£ç¡®é…ç½®ä¸ƒç‰›äº‘ç¯å¢ƒå˜é‡ï¼ˆQINIU_ACCESS_KEY, QINIU_SECRET_KEYç­‰ï¼‰</li>
        <li>âœ… å¼€å‘é˜¶æ®µæ— éœ€ç™»å½•å³å¯æµ‹è¯•</li>
      </ul>
    </div>

    <a href="test-center.html" class="back-link">â† è¿”å›æµ‹è¯•ä¸­å¿ƒ</a>
  </div>

  <!-- åŠ è½½ä¾èµ– -->
  <!-- Supabaseé…ç½®ï¼ˆå¼€å‘æµ‹è¯•é˜¶æ®µå¯é€‰ï¼‰ -->
  <script>
    // å¼€å‘ç¯å¢ƒï¼šåˆ›å»ºç©ºçš„è®¤è¯å¯¹è±¡ï¼Œé¿å…æŠ¥é”™
    window.supabaseAuth = {
      getAccessToken: async () => null,
      isLoggedIn: async () => false
    };
  </script>
  <script src="src/js/test-utils.js"></script>
  
  <script>
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const selectBtn = document.getElementById('selectBtn');
    const clearBtn = document.getElementById('clearBtn');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const resultsSection = document.getElementById('resultsSection');
    const resultsContainer = document.getElementById('resultsContainer');

    // è®¾ç½®æ‹–æ‹½ä¸Šä¼ 
    setupDragAndDrop(dropZone, handleFiles);

    // ç‚¹å‡»é€‰æ‹©æ–‡ä»¶
    dropZone.addEventListener('click', () => fileInput.click());
    selectBtn.addEventListener('click', () => fileInput.click());
    
    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        handleFiles(e.target.files);
      }
    });

    // æ¸…é™¤ç»“æœ
    clearBtn.addEventListener('click', () => {
      clearResults(resultsContainer);
      resultsSection.style.display = 'none';
      clearBtn.disabled = true;
      fileInput.value = '';
    });

    // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
    async function handleFiles(files) {
      // å¼€å‘é˜¶æ®µï¼šè·³è¿‡ç™»å½•æ£€æŸ¥
      // const isLoggedIn = await isUserLoggedIn();
      // if (!isLoggedIn) {
      //   showToast('è¯·å…ˆç™»å½•åå†ä¸Šä¼ æ–‡ä»¶', 'error');
      //   setTimeout(() => {
      //     window.location.href = 'login.html';
      //   }, 2000);
      //   return;
      // }

      const fileArray = Array.from(files);
      
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      loadingIndicator.style.display = 'flex';
      resultsSection.style.display = 'block';
      clearBtn.disabled = false;

      // ä¸Šä¼ æ¯ä¸ªæ–‡ä»¶
      for (const file of fileArray) {
        try {
          const result = await uploadFileToQiniu(file);
          renderUploadResult(result, resultsContainer);
        } catch (error) {
          renderUploadResult({
            success: false,
            error: error.message
          }, resultsContainer);
        }
      }

      // éšè—åŠ è½½çŠ¶æ€
      loadingIndicator.style.display = 'none';
      fileInput.value = '';
    }
  </script>
</body>
</html>

