<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ˜æ–—UIæ ·å¼æµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        h1 {
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }
        
        .info {
            color: white;
            background: rgba(0,0,0,0.3);
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .canvas-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        canvas {
            border: 2px solid #667eea;
            border-radius: 10px;
            display: block;
        }
        
        .legend {
            margin-top: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .legend h3 {
            margin-top: 0;
            color: #667eea;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 10px;
        }
        
        .user-fish {
            background: #00FF00;
        }
        
        .other-fish {
            background: #FF4444;
        }
    </style>
    <script src="public/supabase-config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="src/js/supabase-init.js"></script>
    <script src="src/js/admin-auth.js"></script>
    <script>
        // ç®¡ç†å‘˜æƒé™æ£€æŸ¥
        (async function() {
            if (document.readyState === 'loading') {
                await new Promise(resolve => document.addEventListener('DOMContentLoaded', resolve));
            }
            if (!window.supabaseAuth) {
                await new Promise(resolve => {
                    const checkInterval = setInterval(() => {
                        if (window.supabaseAuth) {
                            clearInterval(checkInterval);
                            resolve();
                        }
                    }, 100);
                });
            }
            await window.adminAuth.requireAdminAccess();
        })();
    </script>
</head>
<body>
    <h1>ğŸ  æˆ˜æ–—UIæ ·å¼æµ‹è¯• âš”ï¸</h1>
    <div class="info">
        <p>å±•ç¤º3ç§UIæ ·å¼æ–¹æ¡ˆï¼Œè¯·é€‰æ‹©æ‚¨å–œæ¬¢çš„æ ·å¼</p>
    </div>
    
    <div class="canvas-container">
        <canvas id="testCanvas" width="800" height="600"></canvas>
    </div>
    
    <div class="legend">
        <h3>ğŸ¨ å›¾ä¾‹è¯´æ˜</h3>
        <div class="legend-item">
            <div class="legend-color user-fish"></div>
            <span><strong>ç»¿è‰²è¡€æ¡</strong> = ä½ çš„é±¼</span>
        </div>
        <div class="legend-item">
            <div class="legend-color other-fish"></div>
            <span><strong>çº¢è‰²è¡€æ¡</strong> = å…¶ä»–ç©å®¶çš„é±¼</span>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('testCanvas');
        const ctx = canvas.getContext('2d');
        
        // ç¤ºä¾‹é±¼æ•°æ®
        const sampleFishes = [
            // æ ·å¼1a: ç´§å‡‘å‹æ”¹è¿›ç‰ˆ (å·¦ä¾§)
            {
                x: 100,
                y: 100,
                name: 'æ ·å¼1aï¼šæ”¹è¿›ç‰ˆ',
                level: 5,
                health: 85,
                maxHealth: 100,
                experience: 45,
                maxExp: 100,
                isUser: true,
                styleType: '1a'
            },
            {
                x: 100,
                y: 220,
                name: 'æ ·å¼1aï¼šæ”¹è¿›ç‰ˆ',
                level: 3,
                health: 30,
                maxHealth: 100,
                experience: 20,
                maxExp: 100,
                isUser: false,
                styleType: '1a'
            },
            
            // æ ·å¼2: ç»å…¸å‹ (ä¸­é—´)
            {
                x: 350,
                y: 100,
                name: 'æ ·å¼2ï¼šç»å…¸å‹',
                level: 7,
                health: 120,
                maxHealth: 140,
                experience: 78,
                maxExp: 100,
                isUser: true,
                styleType: 2
            },
            {
                x: 350,
                y: 220,
                name: 'æ ·å¼2ï¼šç»å…¸å‹',
                level: 2,
                health: 40,
                maxHealth: 60,
                experience: 15,
                maxExp: 100,
                isUser: false,
                styleType: 2
            },
            
            // æ ·å¼3: è¯¦ç»†å‹ (å³ä¾§)
            {
                x: 600,
                y: 100,
                name: 'æ ·å¼3ï¼šè¯¦ç»†å‹',
                level: 10,
                health: 180,
                maxHealth: 200,
                experience: 92,
                maxExp: 100,
                isUser: true,
                styleType: 3
            },
            {
                x: 600,
                y: 220,
                name: 'æ ·å¼3ï¼šè¯¦ç»†å‹',
                level: 1,
                health: 25,
                maxHealth: 50,
                experience: 5,
                maxExp: 100,
                isUser: false,
                styleType: 3
            }
        ];
        
        // ç»˜åˆ¶ç®€å•çš„é±¼å½¢çŠ¶
        function drawSimpleFish(x, y, width, height, direction, color) {
            ctx.save();
            ctx.translate(x, y);
            if (direction < 0) {
                ctx.scale(-1, 1);
            }
            
            // é±¼èº«ä½“
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.ellipse(0, 0, width/2, height/2, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // é±¼å°¾å·´
            ctx.beginPath();
            ctx.moveTo(-width/2, 0);
            ctx.lineTo(-width/2 - 15, -10);
            ctx.lineTo(-width/2 - 15, 10);
            ctx.closePath();
            ctx.fill();
            
            // é±¼çœ¼ç›
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(width/4, -5, 4, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(width/4, -5, 2, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.restore();
        }
        
        // æ ·å¼1: ç´§å‡‘å‹ - åªç”¨å›¾æ ‡å’Œæ•°å­—ï¼Œæ°´å¹³æ’åˆ—ï¼ˆåŸç‰ˆï¼‰
        function drawStyle1UI(fish) {
            const x = fish.x;
            const y = fish.y - 50;
            
            ctx.save();
            ctx.textAlign = 'left';
            
            // ç­‰çº§
            ctx.font = 'bold 16px Arial';
            ctx.fillStyle = '#FFD700';
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 3;
            ctx.strokeText(`Lv.${fish.level}`, x - 30, y);
            ctx.fillText(`Lv.${fish.level}`, x - 30, y);
            
            // è¡€æ¡ - å¿ƒå½¢ + æ•°å­—
            ctx.font = '14px Arial';
            ctx.fillText('â¤ï¸', x - 30, y + 18);
            
            ctx.font = '11px Arial';
            ctx.fillStyle = fish.isUser ? '#00FF00' : '#FF4444';
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2.5;
            ctx.strokeText(`${fish.health}/${fish.maxHealth}`, x - 10, y + 18);
            ctx.fillText(`${fish.health}/${fish.maxHealth}`, x - 10, y + 18);
            
            // ç»éªŒæ¡ - æ˜Ÿæ˜Ÿ + æ•°å­—
            ctx.fillStyle = '#FFD700';
            ctx.font = '13px Arial';
            ctx.fillText('â­', x - 30, y + 32);
            
            ctx.font = '10px Arial';
            ctx.fillStyle = '#FFF';
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.strokeText(`${fish.experience}/100`, x - 10, y + 32);
            ctx.fillText(`${fish.experience}/100`, x - 10, y + 32);
            
            ctx.restore();
        }
        
        // æ ·å¼1a: ç´§å‡‘å‹æ”¹è¿›ç‰ˆ - 5é¢—çº¢å¿ƒ + ç­‰çº§ç»éªŒåŒè¡Œ
        function drawStyle1aUI(fish) {
            const x = fish.x;
            const y = fish.y - 45;
            
            ctx.save();
            
            // === ç¬¬ä¸€è¡Œï¼šç­‰çº§ + ç»éªŒç™¾åˆ†æ¯” ===
            ctx.textAlign = 'center';
            
            // ç­‰çº§
            ctx.font = 'bold 15px Arial';
            ctx.fillStyle = '#FFD700';
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 3;
            const levelText = `Lv.${fish.level}`;
            ctx.strokeText(levelText, x - 25, y);
            ctx.fillText(levelText, x - 25, y);
            
            // ç»éªŒç™¾åˆ†æ¯”ï¼ˆå»æ‰äº”è§’æ˜Ÿï¼‰
            const expPercent = Math.round((fish.experience / fish.maxExp) * 100);
            ctx.font = 'bold 12px Arial';
            ctx.fillStyle = '#FFD700';
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2.5;
            const expText = `${expPercent}%`;
            ctx.strokeText(expText, x + 20, y);
            ctx.fillText(expText, x + 20, y);
            
            // === ç¬¬äºŒè¡Œï¼š5é¢—çº¢å¿ƒè¡¨ç¤ºè¡€é‡ ===
            const heartY = y + 18;
            const heartSpacing = 17; // å¢åŠ çº¢å¿ƒä¹‹é—´çš„é—´è·ï¼Œä»14æ”¹ä¸º17
            const totalHearts = 5;
            const filledHearts = Math.ceil((fish.health / fish.maxHealth) * totalHearts);
            
            // ä»å·¦åˆ°å³ç»˜åˆ¶5é¢—å¿ƒ
            const startX = x - (totalHearts * heartSpacing) / 2 + 8;
            
            ctx.font = '16px Arial';
            for (let i = 0; i < totalHearts; i++) {
                const heartX = startX + i * heartSpacing;
                
                if (i < filledHearts) {
                    // å®å¿ƒçº¢å¿ƒï¼ˆæœªæŸå¤±çš„è¡€ï¼‰
                    ctx.fillStyle = fish.isUser ? '#00FF00' : '#FF4444';
                    ctx.fillText('â¤ï¸', heartX, heartY);
                } else {
                    // ç©ºå¿ƒçº¢å¿ƒï¼ˆæŸå¤±çš„è¡€ï¼‰
                    ctx.fillStyle = fish.isUser ? 'rgba(0,255,0,0.3)' : 'rgba(255,68,68,0.3)';
                    ctx.fillText('ğŸ¤', heartX, heartY);
                }
            }
            
            ctx.restore();
        }
        
        // æ ·å¼2: ç»å…¸å‹ - å›¾æ ‡ + è¿›åº¦æ¡ + æ•°å­—
        function drawStyle2UI(fish) {
            const x = fish.x;
            const y = fish.y - 55;
            const barWidth = 70;
            
            ctx.save();
            
            // ç­‰çº§ - åœ†å½¢å¾½ç« 
            ctx.fillStyle = '#FFD700';
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(x, y, 12, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            
            ctx.fillStyle = '#000';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(fish.level, x, y + 4);
            
            // è¡€æ¡
            const hpY = y + 20;
            
            // èƒŒæ™¯
            ctx.fillStyle = 'rgba(0,0,0,0.5)';
            ctx.fillRect(x - barWidth/2, hpY - 5, barWidth, 8);
            
            // è¡€é‡æ¡
            const hpPercent = fish.health / fish.maxHealth;
            ctx.fillStyle = fish.isUser ? '#00FF00' : '#FF4444';
            ctx.fillRect(x - barWidth/2, hpY - 5, barWidth * hpPercent, 8);
            
            // è¾¹æ¡†
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            ctx.strokeRect(x - barWidth/2, hpY - 5, barWidth, 8);
            
            // æ•°å­—
            ctx.font = '9px Arial';
            ctx.fillStyle = '#FFF';
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.textAlign = 'center';
            const hpText = `${fish.health}/${fish.maxHealth}`;
            ctx.strokeText(hpText, x, hpY + 13);
            ctx.fillText(hpText, x, hpY + 13);
            
            // ç»éªŒæ¡
            const expY = hpY + 22;
            
            // èƒŒæ™¯
            ctx.fillStyle = 'rgba(0,0,0,0.5)';
            ctx.fillRect(x - barWidth/2, expY - 3, barWidth, 6);
            
            // ç»éªŒæ¡
            const expPercent = fish.experience / fish.maxExp;
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(x - barWidth/2, expY - 3, barWidth * expPercent, 6);
            
            // è¾¹æ¡†
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            ctx.strokeRect(x - barWidth/2, expY - 3, barWidth, 6);
            
            // ç»éªŒæ•°å­—
            ctx.font = '8px Arial';
            ctx.fillStyle = '#FFF';
            const expText = `${fish.experience}/100`;
            ctx.strokeText(expText, x, expY + 10);
            ctx.fillText(expText, x, expY + 10);
            
            ctx.restore();
        }
        
        // æ ·å¼3: è¯¦ç»†å‹ - å¸¦å›¾æ ‡çš„è¿›åº¦æ¡ + ç™¾åˆ†æ¯”
        function drawStyle3UI(fish) {
            const x = fish.x;
            const y = fish.y - 65;
            const barWidth = 80;
            
            ctx.save();
            
            // åå­—èƒŒæ™¯
            ctx.fillStyle = 'rgba(0,0,0,0.7)';
            ctx.fillRect(x - 40, y - 10, 80, 16);
            
            // ç­‰çº§æ˜¾ç¤º
            ctx.font = 'bold 14px Arial';
            ctx.fillStyle = '#FFD700';
            ctx.textAlign = 'center';
            ctx.fillText(`âš”ï¸ Lv.${fish.level}`, x, y + 2);
            
            // è¡€æ¡éƒ¨åˆ†
            const hpY = y + 20;
            
            // å¿ƒå½¢å›¾æ ‡
            ctx.font = '14px Arial';
            ctx.fillText('â¤ï¸', x - barWidth/2 - 12, hpY + 4);
            
            // è¡€æ¡èƒŒæ™¯
            ctx.fillStyle = 'rgba(0,0,0,0.6)';
            ctx.fillRect(x - barWidth/2, hpY - 5, barWidth, 10);
            
            // è¡€é‡æ¡
            const hpPercent = fish.health / fish.maxHealth;
            const gradient = ctx.createLinearGradient(x - barWidth/2, 0, x + barWidth/2, 0);
            if (fish.isUser) {
                gradient.addColorStop(0, '#00FF00');
                gradient.addColorStop(1, '#00CC00');
            } else {
                gradient.addColorStop(0, '#FF4444');
                gradient.addColorStop(1, '#CC0000');
            }
            ctx.fillStyle = gradient;
            ctx.fillRect(x - barWidth/2, hpY - 5, barWidth * hpPercent, 10);
            
            // è¾¹æ¡†
            ctx.strokeStyle = fish.isUser ? '#00FF00' : '#FF4444';
            ctx.lineWidth = 2;
            ctx.strokeRect(x - barWidth/2, hpY - 5, barWidth, 10);
            
            // æ•°å­—
            ctx.font = 'bold 10px Arial';
            ctx.fillStyle = '#FFF';
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2.5;
            ctx.textAlign = 'center';
            const hpText = `${fish.health}/${fish.maxHealth} (${Math.round(hpPercent * 100)}%)`;
            ctx.strokeText(hpText, x, hpY + 16);
            ctx.fillText(hpText, x, hpY + 16);
            
            // ç»éªŒæ¡éƒ¨åˆ†
            const expY = hpY + 28;
            
            // æ˜Ÿæ˜Ÿå›¾æ ‡
            ctx.font = '13px Arial';
            ctx.fillStyle = '#FFD700';
            ctx.fillText('â­', x - barWidth/2 - 12, expY + 3);
            
            // ç»éªŒæ¡èƒŒæ™¯
            ctx.fillStyle = 'rgba(0,0,0,0.6)';
            ctx.fillRect(x - barWidth/2, expY - 4, barWidth, 8);
            
            // ç»éªŒæ¡
            const expPercent = fish.experience / fish.maxExp;
            const expGradient = ctx.createLinearGradient(x - barWidth/2, 0, x + barWidth/2, 0);
            expGradient.addColorStop(0, '#FFD700');
            expGradient.addColorStop(1, '#FFA500');
            ctx.fillStyle = expGradient;
            ctx.fillRect(x - barWidth/2, expY - 4, barWidth * expPercent, 8);
            
            // è¾¹æ¡†
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 1.5;
            ctx.strokeRect(x - barWidth/2, expY - 4, barWidth, 8);
            
            // ç»éªŒæ•°å­—
            ctx.font = '9px Arial';
            ctx.fillStyle = '#FFF';
            ctx.lineWidth = 2;
            const expText = `EXP: ${fish.experience}/100 (${Math.round(expPercent * 100)}%)`;
            ctx.strokeText(expText, x, expY + 12);
            ctx.fillText(expText, x, expY + 12);
            
            ctx.restore();
        }
        
        // æ¸²æŸ“æ‰€æœ‰é±¼å’ŒUI
        function render() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.fillStyle = '#E0F7FF';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶æ ‡é¢˜
            ctx.fillStyle = '#333';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            
            ctx.fillText('æ ·å¼1a: æ”¹è¿›ç‰ˆ â­', 130, 50);
            ctx.fillText('æ ·å¼2: ç»å…¸å‹', 380, 50);
            ctx.fillText('æ ·å¼3: è¯¦ç»†å‹', 640, 50);
            
            // ç»˜åˆ¶åˆ†éš”çº¿
            ctx.strokeStyle = '#ccc';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(250, 60);
            ctx.lineTo(250, 350);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(500, 60);
            ctx.lineTo(500, 350);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // ç»˜åˆ¶æ¯æ¡é±¼
            sampleFishes.forEach(fish => {
                // ç»˜åˆ¶é±¼
                const fishColor = fish.isUser ? '#4A90E2' : '#E27A4A';
                drawSimpleFish(fish.x, fish.y + 30, 50, 30, 1, fishColor);
                
                // æ ¹æ®æ ·å¼ç±»å‹ç»˜åˆ¶UI
                switch(fish.styleType) {
                    case 1:
                        drawStyle1UI(fish);
                        break;
                    case '1a':
                        drawStyle1aUI(fish);
                        break;
                    case 2:
                        drawStyle2UI(fish);
                        break;
                    case 3:
                        drawStyle3UI(fish);
                        break;
                }
                
                // ç»˜åˆ¶æ ‡ç­¾
                ctx.font = '11px Arial';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText(fish.isUser ? '(ä½ çš„é±¼)' : '(å…¶ä»–ç©å®¶)', fish.x, fish.y + 70);
            });
            
            // åº•éƒ¨è¯´æ˜
            ctx.font = 'bold 14px Arial';
            ctx.fillStyle = '#667eea';
            ctx.textAlign = 'center';
            ctx.fillText('ğŸ‘† æ ·å¼1a: 5é¢—çº¢å¿ƒè¡€é‡ + ç­‰çº§ç»éªŒåŒè¡Œ', canvas.width / 2, 400);
            
            ctx.font = '12px Arial';
            ctx.fillStyle = '#666';
            ctx.fillText('ç»¿è‰²å¿ƒ=ä½ çš„é±¼  |  çº¢è‰²å¿ƒ=å…¶ä»–é±¼  |  ç©ºå¿ƒ=æŸå¤±çš„è¡€é‡', canvas.width / 2, 420);
        }
        
        // åˆå§‹æ¸²æŸ“
        render();
        
        // åŠ¨ç”»æ•ˆæœï¼ˆå¯é€‰ï¼‰
        let frame = 0;
        function animate() {
            frame++;
            if (frame % 60 === 0) {
                render();
            }
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>

