<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ˜æ–—ç³»ç»Ÿè‡ªåŠ¨æµ‹è¯• - Fish Art</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            max-width: 800px;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        
        .status {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-label {
            font-weight: 600;
            color: #666;
            margin-right: 10px;
            min-width: 120px;
        }
        
        .status-value {
            color: #333;
        }
        
        .status-icon {
            font-size: 20px;
            margin-right: 10px;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .log-box {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .log-entry {
            margin-bottom: 5px;
        }
        
        .log-success { color: #10b981; }
        .log-error { color: #ef4444; }
        .log-info { color: #3b82f6; }
        .log-warning { color: #f59e0b; }
        
        .loading {
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
        
        .test-checklist {
            background: #fff9e6;
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .test-checklist h3 {
            color: #d97706;
            margin-bottom: 15px;
        }
        
        .test-checklist ul {
            list-style: none;
            padding: 0;
        }
        
        .test-checklist li {
            padding: 8px 0;
            color: #666;
        }
        
        .test-checklist li:before {
            content: "âœ“ ";
            color: #10b981;
            font-weight: bold;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŸ æˆ˜æ–—ç³»ç»Ÿè‡ªåŠ¨æµ‹è¯•</h1>
        <p class="subtitle">è‡ªåŠ¨ç™»å½•å¹¶æµ‹è¯•æˆ˜æ–—ç³»ç»Ÿ</p>
        
        <!-- åŠ è½½çŠ¶æ€ -->
        <div id="loading-section" class="loading">
            <div class="spinner"></div>
            <p>æ­£åœ¨åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ...</p>
        </div>
        
        <!-- æµ‹è¯•å‡­æ®çŠ¶æ€ -->
        <div id="status-section" class="status hidden">
            <div class="status-item">
                <span class="status-icon">ğŸ”‘</span>
                <span class="status-label">æµ‹è¯•è´¦å·:</span>
                <span class="status-value" id="test-email">-</span>
            </div>
            <div class="status-item">
                <span class="status-icon">ğŸ”’</span>
                <span class="status-label">å¯†ç :</span>
                <span class="status-value" id="test-password">-</span>
            </div>
            <div class="status-item">
                <span class="status-icon">ğŸ“¡</span>
                <span class="status-label">æœåŠ¡å™¨çŠ¶æ€:</span>
                <span class="status-value" id="server-status">æ£€æŸ¥ä¸­...</span>
            </div>
            <div class="status-item">
                <span class="status-icon">ğŸ‘¤</span>
                <span class="status-label">ç™»å½•çŠ¶æ€:</span>
                <span class="status-value" id="login-status">æœªç™»å½•</span>
            </div>
        </div>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <div id="actions-section" class="hidden">
            <button class="btn btn-primary" onclick="autoLogin()">ğŸš€ è‡ªåŠ¨ç™»å½•</button>
            <button class="btn btn-primary" onclick="gotoBattleDemo()">âš”ï¸ è¿›å…¥æˆ˜æ–—æµ‹è¯•</button>
            <button class="btn btn-secondary" onclick="manualLogin()">ğŸ”“ æ‰‹åŠ¨ç™»å½•</button>
        </div>
        
        <!-- æµ‹è¯•æ£€æŸ¥æ¸…å• -->
        <div class="test-checklist hidden" id="test-checklist">
            <h3>ğŸ¯ æµ‹è¯•è¦ç‚¹</h3>
            <ul>
                <li>åŒä¸€è¡Œçš„é±¼æ˜¯å¦èƒ½æ­£å¸¸ç¢°æ’</li>
                <li>ä¸åŒè¡Œçš„é±¼æ˜¯å¦ä¸ä¼šç¢°æ’</li>
                <li>ç¢°æ’æ•ˆæœæ˜¯å¦ç«‹å³æ˜¾ç¤ºåœ¨ä¸¤é±¼ä¸­é—´</li>
                <li>æ‰€æœ‰é±¼æ˜¯å¦éƒ½æ˜¾ç¤ºçŠ¶æ€UIï¼ˆLv, è¡€æ¡ï¼‰</li>
                <li>ç¢°æ’åŠ¨ç”»æ˜¯å¦æµç•…æ¸…æ™°</li>
            </ul>
        </div>
        
        <!-- æ—¥å¿— -->
        <div id="log-box" class="log-box">
            <div class="log-entry log-info">ç³»ç»Ÿå°±ç»ªï¼Œç­‰å¾…åˆå§‹åŒ–...</div>
        </div>
    </div>
    
    <!-- Supabase SDK -->
    <script src="public/supabase-config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="src/js/supabase-init.js"></script>
    
    <script>
        let testCredentials = null;
        
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logBox = document.getElementById('log-box');
            const time = new Date().toLocaleTimeString('zh-CN');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${time}] ${message}`;
            logBox.appendChild(entry);
            logBox.scrollTop = logBox.scrollHeight;
        }
        
        // è·å–æµ‹è¯•å‡­æ®
        async function getTestCredentials() {
            try {
                log('æ­£åœ¨è·å–æµ‹è¯•å‡­æ®...', 'info');
                const response = await fetch('/api/config/test-credentials');
                const data = await response.json();
                
                if (data.email && data.password) {
                    testCredentials = data;
                    document.getElementById('test-email').textContent = data.email;
                    document.getElementById('test-password').textContent = 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢';
                    log('âœ… æµ‹è¯•å‡­æ®è·å–æˆåŠŸ', 'success');
                    return true;
                } else {
                    log('âŒ æµ‹è¯•å‡­æ®ä¸å¯ç”¨', 'error');
                    return false;
                }
            } catch (error) {
                log(`âŒ è·å–æµ‹è¯•å‡­æ®å¤±è´¥: ${error.message}`, 'error');
                return false;
            }
        }
        
        // æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
        async function checkServer() {
            try {
                log('æ­£åœ¨æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€...', 'info');
                const response = await fetch('/api/config/battle');
                if (response.ok) {
                    document.getElementById('server-status').textContent = 'âœ… åœ¨çº¿';
                    log('âœ… æœåŠ¡å™¨åœ¨çº¿', 'success');
                    return true;
                } else {
                    document.getElementById('server-status').textContent = 'âŒ ç¦»çº¿';
                    log('âŒ æœåŠ¡å™¨ç¦»çº¿', 'error');
                    return false;
                }
            } catch (error) {
                document.getElementById('server-status').textContent = 'âŒ æ— æ³•è¿æ¥';
                log(`âŒ æœåŠ¡å™¨è¿æ¥å¤±è´¥: ${error.message}`, 'error');
                return false;
            }
        }
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        async function checkLoginStatus() {
            try {
                log('æ­£åœ¨æ£€æŸ¥ç™»å½•çŠ¶æ€...', 'info');
                if (window.supabaseAuth && window.supabaseAuth.getUser) {
                    const user = await window.supabaseAuth.getUser();
                    if (user) {
                        document.getElementById('login-status').textContent = `âœ… å·²ç™»å½• (${user.email})`;
                        log(`âœ… å·²ç™»å½•: ${user.email}`, 'success');
                        return true;
                    }
                }
                document.getElementById('login-status').textContent = 'âŒ æœªç™»å½•';
                log('âš  æœªç™»å½•', 'warning');
                return false;
            } catch (error) {
                log(`âŒ æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥: ${error.message}`, 'error');
                return false;
            }
        }
        
        // è‡ªåŠ¨ç™»å½•
        async function autoLogin() {
            if (!testCredentials) {
                log('âŒ æ²¡æœ‰å¯ç”¨çš„æµ‹è¯•å‡­æ®', 'error');
                alert('æµ‹è¯•å‡­æ®ä¸å¯ç”¨ï¼Œè¯·æ‰‹åŠ¨ç™»å½•');
                return;
            }
            
            try {
                log('æ­£åœ¨è‡ªåŠ¨ç™»å½•...', 'info');
                log(`ä½¿ç”¨è´¦å·: ${testCredentials.email}`, 'info');
                
                if (!window.supabaseAuth || !window.supabaseAuth.signIn) {
                    log('âŒ Supabase æœªåˆå§‹åŒ–', 'error');
                    alert('è®¤è¯ç³»ç»Ÿæœªå°±ç»ªï¼Œè¯·ç¨åé‡è¯•');
                    return;
                }
                
                const result = await window.supabaseAuth.signIn(
                    testCredentials.email,
                    testCredentials.password
                );
                
                if (result.success) {
                    log('âœ… ç™»å½•æˆåŠŸï¼', 'success');
                    document.getElementById('login-status').textContent = `âœ… å·²ç™»å½• (${testCredentials.email})`;
                    alert('ç™»å½•æˆåŠŸï¼ç‚¹å‡»"è¿›å…¥æˆ˜æ–—æµ‹è¯•"å¼€å§‹æµ‹è¯•');
                } else {
                    log(`âŒ ç™»å½•å¤±è´¥: ${result.error}`, 'error');
                    alert(`ç™»å½•å¤±è´¥: ${result.error}`);
                }
            } catch (error) {
                log(`âŒ ç™»å½•é”™è¯¯: ${error.message}`, 'error');
                alert(`ç™»å½•é”™è¯¯: ${error.message}`);
            }
        }
        
        // è¿›å…¥æˆ˜æ–—æµ‹è¯•
        function gotoBattleDemo() {
            log('ğŸ® è·³è½¬åˆ°æˆ˜æ–—æµ‹è¯•é¡µé¢...', 'info');
            window.location.href = 'battle-demo.html';
        }
        
        // æ‰‹åŠ¨ç™»å½•
        function manualLogin() {
            log('ğŸ”“ è·³è½¬åˆ°ç™»å½•é¡µé¢...', 'info');
            window.location.href = 'login.html';
        }
        
        // åˆå§‹åŒ–
        async function initialize() {
            log('ğŸš€ åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ...', 'info');
            
            // 1. è·å–æµ‹è¯•å‡­æ®
            const hasCredentials = await getTestCredentials();
            
            // 2. æ£€æŸ¥æœåŠ¡å™¨
            const serverOnline = await checkServer();
            
            // 3. æ£€æŸ¥ç™»å½•çŠ¶æ€
            const isLoggedIn = await checkLoginStatus();
            
            // éšè—åŠ è½½ï¼Œæ˜¾ç¤ºå†…å®¹
            document.getElementById('loading-section').classList.add('hidden');
            document.getElementById('status-section').classList.remove('hidden');
            document.getElementById('actions-section').classList.remove('hidden');
            document.getElementById('test-checklist').classList.remove('hidden');
            
            if (hasCredentials && serverOnline) {
                if (isLoggedIn) {
                    log('âœ… å·²ç™»å½•ï¼Œå¯ä»¥ç›´æ¥å¼€å§‹æµ‹è¯•', 'success');
                    alert('æ‚¨å·²ç™»å½•ï¼å¯ä»¥ç›´æ¥è¿›å…¥æˆ˜æ–—æµ‹è¯•');
                } else {
                    log('ğŸ’¡ ç‚¹å‡»"è‡ªåŠ¨ç™»å½•"æŒ‰é’®å¼€å§‹', 'info');
                }
            } else {
                log('âš  è¯·æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€æˆ–æ‰‹åŠ¨ç™»å½•', 'warning');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', () => {
            // ç­‰å¾… Supabase åˆå§‹åŒ–
            setTimeout(initialize, 1000);
        });
    </script>
</body>
</html>












